(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[381],{1277:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(9827),s=n(709);let a=(0,r.v)()((0,s.Zr)(e=>({user:null,setUser:t=>e({user:t}),removeUser:()=>e({user:null}),changeOrg:t=>e(e=>e.user?{user:{...e.user,current_org:t}}:e)}),{name:"user-session",storage:(0,s.KU)(()=>localStorage)}))},1381:(e,t,n)=>{"use strict";n.d(t,{A2:()=>i,Aj:()=>o,gK:()=>l,sX:()=>s,wz:()=>a});var r=n(1277);async function s(e){let{user:t,setUser:n}=r.A.getState(),s={name:e.user.name,current_org:{id:e.id,name:e.name,type:e.type},orgs:Object.keys(e.orgs).map(t=>({id:t,name:e.orgs[t].name,type:e.orgs[t].type}))};s.orgs.unshift(s.current_org),n(s)}function a(){let{user:e}=r.A.getState();if(e)return e}function i(){let{user:e}=r.A.getState();if(e)return e.current_org.type}function l(){let{user:e}=r.A.getState();if(e)return e.current_org}function o(e){let{user:t,changeOrg:n}=r.A.getState();if(!t)return;let s=null;t.orgs.forEach(t=>{t.id===e&&(s=t)}),s&&n(s)}},1567:(e,t,n)=>{"use strict";function r(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"de-DE";return new Date(e).toLocaleString(t)}function s(e){let t=new Date,n=new Date;return n.setDate(t.getDate()-e),{start:n.toISOString().split("T")[0],end:t.toISOString().split("T")[0]}}function a(e,t){let n=e[t];return null==n||"null"===n?"":n}n.d(t,{Tl:()=>a,Yq:()=>r,uo:()=>s})},2914:(e,t,n)=>{"use strict";n.d(t,{A:()=>i});var r=n(5155),s=n(6646),a=n(9499);function i(){return(0,r.jsx)(s.s,{align:"center",justify:"center",children:(0,r.jsx)(a.y,{size:"3"})})}},6673:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>O});var r=n(5155),s=n(6646),a=n(5169),i=n(3508),l=n(1821),o=n(7365),c=n(3394);function d(e){let{onChange:t}=e;return(0,r.jsx)(c.Root,{className:"mt-4 sm:mt-auto",onChange:e=>t(e.target.value),placeholder:"Leads durchsuchen...",children:(0,r.jsx)(c.Slot,{children:(0,r.jsx)(o.$p$,{height:"16",width:"16"})})})}var u=n(2115),h=n(1381),m=n(691),g=n(9719);function j(e){let{message:t,type:n,duration:i=3e3,open:l,changeState:o}=e;return l?(0,r.jsxs)(m.Provider,{duration:i,children:[(0,r.jsxs)(m.Root,{className:"ToastRoot",open:l,onOpenChange:()=>{o(!1)},children:[(0,r.jsx)(m.Title,{className:"ToastTitle",children:(0,r.jsx)(s.s,{direction:"row",align:"center",gap:"2",children:(0,r.jsx)(a.D,{as:"h3",size:"4",color:"success"===n?"green":"red",children:"success"===n?"Erfolgreich!":"Fehler!"})})}),(0,r.jsx)(m.Description,{className:"ToastDescription",children:(0,r.jsx)(g.E,{children:t})}),(0,r.jsx)(m.Close,{})]}),(0,r.jsx)(m.Viewport,{className:"ToastViewport"})]}):null}function p(){let[e,t]=(0,u.useState)(!1),[n,a]=(0,u.useState)(""),[i,o]=(0,u.useState)("success");async function d(e){var n,r,s;e.preventDefault();let i={company_name:(n=new FormData(e.currentTarget)).get("create_company_name"),name:n.get("create_name"),email:n.get("create_email"),website:"",mobile_phone:n.get("create_phone"),phone:n.get("create_phone"),note:n.get("create_note"),partner_id:null!==(s=null===(r=(0,h.gK)())||void 0===r?void 0:r.id)&&void 0!==s?s:""};if(!(await fetch("/api/leads",{method:"POST",body:JSON.stringify(i)})).ok){o("error"),a("Fehler beim Erstellen des Leads"),t(!0);return}o("success"),a("Lead erfolgreich erstellt"),t(!0)}return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("form",{onSubmit:d,className:"w-full",children:(0,r.jsxs)(s.s,{direction:{initial:"column",md:"row"},gap:"3",align:"center",children:[(0,r.jsx)(c.Root,{name:"create_company_name",size:"2",placeholder:"Firmenname",required:!0}),(0,r.jsx)(c.Root,{name:"create_name",size:"2",placeholder:"Kontaktperson"}),(0,r.jsx)(c.Root,{name:"create_email",type:"email",size:"2",placeholder:"Email",required:!0}),(0,r.jsx)(c.Root,{name:"create_phone",type:"tel",pattern:"^\\+?[1-9](?:\\d\\s?){1,14}$",size:"2",placeholder:"+49 1512 345 678 9"}),(0,r.jsx)(c.Root,{name:"create_note",size:"2",placeholder:"Notiz"}),(0,r.jsx)(l.$,{type:"submit",variant:"soft",children:"Speichern"})]})}),(0,r.jsx)(j,{open:e,type:i,message:n,changeState:t})]})}let f=(0,n(9827).v)(e=>({leads:null,filteredLeads:null,setLeads:t=>e({leads:t,filteredLeads:t}),filterLeads:t=>(e(e=>e.leads?0===t.length?{filteredLeads:e.leads}:{filteredLeads:e.leads.filter(e=>e.company_name.toLowerCase().includes(t.toLowerCase())||e.name.toLowerCase().includes(t.toLowerCase())||e.email.toLowerCase().includes(t.toLowerCase())||e.phone.toLowerCase().includes(t.toLowerCase())||e.mobile_phone.toLowerCase().includes(t.toLowerCase()))}:{filteredLeads:null}),null),addLead:t=>e(e=>({leads:[...e.leads||[],t]})),updateLead:t=>e(e=>{var n;return{leads:(null===(n=e.leads)||void 0===n?void 0:n.map(e=>e.id===t.id?t:e))||null}}),removeLead:t=>e(e=>{var n;return{leads:(null===(n=e.leads)||void 0===n?void 0:n.filter(e=>e.id!==t))||null}})}));function x(e){let{updateLead:t}=f.getState();t(e)}function y(e,t){var n;fetch("/api/leads/convert",{method:"POST",body:JSON.stringify({id:e,type:t,org_id:null===(n=(0,h.gK)())||void 0===n?void 0:n.id})}).then(async e=>{if(!e.ok)return!1;{let t=await e.json();console.log("data",t),x(t)}})}var b=n(2914),v=n(382),w=n(2112),_=n(4911),L=n(1567),k=n(8435);function S(){return(0,r.jsx)("svg",{version:"1.0",xmlns:"http://www.w3.org/2000/svg",width:"25",height:"25",viewBox:"0 0 512.000000 512.000000",preserveAspectRatio:"xMidYMid meet",children:(0,r.jsxs)("g",{transform:"translate(0.000000,512.000000) scale(0.100000,-0.100000)",stroke:"none",children:[(0,r.jsx)("path",{d:"M2610 5033 c-718 -38 -1130 -297 -1304 -818 -58 -173 -93 -418 -97 -670 l-2 -130 736 -3 737 -2 0 815 c0 448 -3 814 -7 813 -5 -1 -33 -3 -63 -5z"}),(0,r.jsx)("path",{d:"M2820 4226 l0 -816 757 0 756 0 -7 163 c-23 581 -175 945 -491 1180 -224 166 -508 253 -927 282 l-88 6 0 -815z",fill:"#2388AE"}),(0,r.jsx)("path",{d:"M1207 2343 c2 -601 7 -995 14 -1057 19 -180 84 -354 189 -512 71 -106 252 -284 369 -362 387 -260 888 -351 1376 -250 213 43 461 150 629 269 250 179 435 435 501 694 39 152 44 309 45 1288 l0 887 -1562 0 -1563 0 2 -957z"})]})})}var z=n(4765),E=n(1401),T=n(8026);function N(e){let{lead:t}=e,[n,a]=(0,u.useState)(!1),[i,o]=(0,u.useState)(""),[d,m]=(0,u.useState)("success");function p(e,t){m(e),o(t),a(!0)}return(0,u.useEffect)(()=>{t&&function(e){let t=document.querySelector("form");t&&Object.entries(e).forEach(e=>{let[n,r]=e,s=t.querySelector('[name="'.concat(n,'"]'));s&&(s.value=r)})}(t)},[t]),(0,r.jsxs)(z.UC,{maxWidth:"450px",children:[(0,r.jsxs)("form",{onSubmit:function(e){var n,r;e.preventDefault();let s=new FormData(e.currentTarget);fetch("/api/leads",{method:"PUT",body:JSON.stringify({id:t.id,company_name:s.get("company_name"),name:s.get("name"),email:s.get("email"),website:s.get("website"),mobile_phone:s.get("mobile_phone"),phone:s.get("phone"),note:s.get("note"),partner_id:null!==(r=null===(n=(0,h.gK)())||void 0===n?void 0:n.id)&&void 0!==r?r:""})}).then(async e=>{if(e.ok){let t=await e.json();p("success","Lead erfolgreich aktualisiert"),x(t)}else p("error","Fehler beim Aktualisieren des Leads")})},children:[(0,r.jsx)(z.hE,{children:"Lead bearbeiten"}),(0,r.jsx)(z.VY,{size:"2",mb:"4",children:"Bearbeiten sie die Informationen des Leads."}),(0,r.jsxs)(E.x,{columns:"2",gap:"4",children:[(0,r.jsxs)(s.s,{direction:"column",gap:"1",children:[(0,r.jsx)(g.E,{size:"3",children:"Firmenname"}),(0,r.jsx)(c.Root,{defaultValue:(0,L.Tl)(t,"company_name"),name:"company_name",size:"2",required:!0})]}),(0,r.jsxs)(s.s,{direction:"column",gap:"1",children:[(0,r.jsx)(g.E,{size:"3",children:"Webseite"}),(0,r.jsx)(c.Root,{defaultValue:(0,L.Tl)(t,"website"),name:"website",size:"2"})]}),(0,r.jsxs)(s.s,{direction:"column",gap:"1",children:[(0,r.jsx)(g.E,{size:"3",children:"Kontaktperson"}),(0,r.jsx)(c.Root,{defaultValue:(0,L.Tl)(t,"name"),name:"name",size:"2",required:!0})]}),(0,r.jsxs)(s.s,{direction:"column",gap:"1",children:[(0,r.jsx)(g.E,{size:"3",children:"E-Mail"}),(0,r.jsx)(c.Root,{defaultValue:(0,L.Tl)(t,"email"),name:"email",type:"email",size:"2",required:!0})]}),(0,r.jsxs)(s.s,{direction:"column",gap:"1",children:[(0,r.jsx)(g.E,{size:"3",children:"Telefon"}),(0,r.jsx)(c.Root,{defaultValue:(0,L.Tl)(t,"phone"),name:"phone",size:"2",type:"tel",pattern:"^\\+?[1-9](?:\\d\\s?){1,14}$",placeholder:"+49 1512 345 678 9"})]}),(0,r.jsxs)(s.s,{direction:"column",gap:"1",children:[(0,r.jsx)(g.E,{size:"3",children:"Mobiltelefon"}),(0,r.jsx)(c.Root,{defaultValue:(0,L.Tl)(t,"mobile_phone"),name:"mobile_phone",type:"tel",pattern:"^\\+?[1-9](?:\\d\\s?){1,14}$",size:"2",placeholder:"+49 1512 345 678 9"})]})]}),(0,r.jsxs)(s.s,{className:"pt-4",direction:"column",gap:"1",children:[(0,r.jsx)(g.E,{size:"3",children:"Notiz"}),(0,r.jsx)(T.f,{defaultValue:(0,L.Tl)(t,"note"),name:"note",size:"2"})]}),(0,r.jsxs)(s.s,{className:"pt-5",justify:"end",direction:"row",gap:"3",children:[(0,r.jsx)(z.bm,{children:(0,r.jsx)(l.$,{variant:"soft",color:"gray",children:"Cancel"})}),(0,r.jsx)(l.$,{type:"submit",children:"Save"})]})]}),(0,r.jsx)(j,{open:n,type:d,message:i,changeState:a})]})}function C(e){let{lead:t}=e;return(0,r.jsxs)(z.UC,{maxWidth:"450px",children:[(0,r.jsx)(z.hE,{children:"Lead L\xf6schen"}),(0,r.jsx)(z.VY,{size:"2",children:"Bist du sicher, dass du diesen Lead l\xf6schen m\xf6chtest? Diese Aktion kann nicht r\xfcckg\xe4ngig gemacht werden."}),(0,r.jsxs)(s.s,{gap:"3",mt:"4",justify:"end",children:[(0,r.jsx)(z.bm,{children:(0,r.jsx)(l.$,{variant:"soft",color:"gray",children:"Abbrechen"})}),(0,r.jsx)(z.bm,{children:(0,r.jsx)(l.$,{variant:"solid",color:"red",onClick:()=>(function(e){fetch("/api/leads/",{method:"DELETE",body:JSON.stringify({id:e})}).then(async t=>!!t.ok&&(!function(e){let{removeLead:t}=f.getState();t(e)}(e),!0))})(t.id),children:"L\xf6schen"})})]})]})}var D=n(8577);function K(e){let{children:t,condition:n}=e;return n?(0,r.jsx)(r.Fragment,{children:t}):(0,r.jsx)(r.Fragment,{})}function A(e){var t;let{item:n,dialog:s}=e,a=(0,u.useRef)(null);return n.hotkey&&(0,D.vC)(n.hotkey.key,e=>{var t;null===(t=n.hotkey)||void 0===t||t.action(e)}),(0,r.jsxs)(z.bL,{children:[(0,r.jsx)(K,{condition:n.separator,children:(0,r.jsx)(w.Separator,{})}),(0,r.jsxs)(w.Item,{color:n.color,id:n.name,shortcut:null===(t=n.hotkey)||void 0===t?void 0:t.shortcut,onClick:e=>{!function(e){var t,r;if(e.preventDefault(),!n.dialog){null===(r=n.hotkey)||void 0===r||r.action(e);return}null==a||null===(t=a.current)||void 0===t||t.click()}(e)},children:[n.description,(0,r.jsx)("div",{children:(0,r.jsx)(z.l9,{ref:a,children:(0,r.jsx)("div",{})})})]}),s]})}function R(e){let{lead:t}=e,n=[{name:"edit-lead",description:"Bearbeiten",separator:!1,color:"blue",dialog:(0,r.jsx)(N,{lead:t}),hotkey:{key:"meta+e",action:e=>{e.preventDefault();let t=document.getElementById("edit-lead");t&&t.click()},shortcut:"⌘ E"}},{name:"delete-lead",description:"L\xf6schen",color:"red",separator:!0,dialog:(0,r.jsx)(C,{lead:t}),hotkey:{key:"meta+backspace",action:e=>{e.preventDefault();let t=document.getElementById("delete-lead");t&&t.click()},shortcut:"⌘ ⌫"}}],s=[{name:"convert-lead",description:"Konvertieren",items:[{name:"lead-to-interest",description:"Zu Interessent",separator:!1,color:"gray",dialog:null,hotkey:{key:"meta+i",action:e=>{y(t.id,16)},shortcut:"⌘ I"}},{name:"lead-to-customer",description:"Zu Kunde",separator:!1,color:"gray",dialog:null,hotkey:{key:"meta+k",action:e=>{y(t.id,1)},shortcut:"⌘ K"}}]}];return(0,r.jsx)(D.Hb,{children:(0,r.jsxs)(w.Content,{children:[s.map(e=>(0,r.jsxs)(w.Sub,{children:[(0,r.jsx)(w.SubTrigger,{children:e.description}),(0,r.jsx)(w.SubContent,{children:e.items.map(e=>(0,r.jsx)(A,{item:e,dialog:e.dialog},e.name))})]},e.name)),n.map(e=>(0,r.jsx)(A,{item:e,dialog:e.dialog},e.name))]})})}function M(){let e=function(){let{filteredLeads:e}=f.getState();if(e)return e}();return e?(0,r.jsxs)(v.bL,{className:"select-none sm:select-text",children:[(0,r.jsx)(v.Y9,{children:(0,r.jsx)(v.fI,{children:[{id:"firmenname",label:"Firmenname"},{id:"webseite",label:"Webseite"},{id:"type",label:"Typ"},{id:"erstellt_am",label:"Erstellt am",className:"hidden sm:table-cell"},{id:"gueltig_bis",label:"G\xfcltig bis",className:"hidden sm:table-cell"},{id:"actions",label:"Aktionen",className:"hidden sm:table-cell"}].map(e=>(0,r.jsx)(v.Oh,{className:e.className,children:e.label},e.id))})}),(0,r.jsx)(v.nB,{children:e.map(e=>(0,r.jsxs)(w.Root,{children:[(0,r.jsx)(w.Trigger,{children:(0,r.jsxs)(v.fI,{children:[(0,r.jsx)(v.fh,{children:(0,L.Tl)(e,"company_name")}),(0,r.jsx)(v.fh,{children:(0,L.Tl)(e,"website")}),(0,r.jsx)(v.fh,{children:(0,r.jsx)(_.E,{color:(0,k.fY)(e.lead_org_type),children:(0,k.qj)(e.lead_org_type)})}),(0,r.jsx)(v.fh,{className:"hidden sm:table-cell",children:(0,L.Yq)((0,L.Tl)(e,"created_on"))}),(0,r.jsx)(v.fh,{className:"hidden sm:table-cell",children:(0,L.Yq)(e.valid_til)}),(0,r.jsx)(v.fh,{className:"hidden sm:table-cell",children:(0,r.jsx)(S,{})})]})}),(0,r.jsx)(R,{lead:e})]},e.id))})]}):(0,r.jsx)(b.A,{})}function O(){let[e,t]=(0,u.useState)(!1),{setLeads:n,filterLeads:c}=f(),h=async()=>{await fetch("api/leads",{method:"GET"}).then(async e=>{if(e.ok){let t=await e.json();console.log(t),n(t)}})};return(0,u.useEffect)(()=>{h()},[]),(0,r.jsxs)(s.s,{direction:"column",gap:"6",className:"",children:[(0,r.jsxs)(s.s,{direction:{initial:"column",md:"row"},justify:"between",align:"center",children:[(0,r.jsx)(a.D,{size:"8",children:"Leads"}),(0,r.jsxs)(s.s,{gap:"3",direction:{initial:"column",md:"row"},children:[(0,r.jsx)(d,{onChange:c}),(0,r.jsxs)(K,{condition:e,children:[(0,r.jsx)(i.w,{size:{initial:"4",md:"2"},orientation:{initial:"horizontal",md:"vertical"}}),(0,r.jsx)(s.s,{justify:"end",children:(0,r.jsx)(p,{})})]}),(0,r.jsxs)(l.$,{onClick:function(){t(e=>!e)},color:e?"gray":"blue",children:[(0,r.jsxs)(K,{condition:!e,children:[(0,r.jsx)(o.c11,{}),"Lead hinzuf\xfcgen"]}),(0,r.jsxs)(K,{condition:e,children:[(0,r.jsx)(o.raE,{}),"Abbrechen"]})]})]})]}),(0,r.jsx)(M,{})]})}},7446:(e,t,n)=>{Promise.resolve().then(n.bind(n,6673))},8435:(e,t,n)=>{"use strict";n.d(t,{fY:()=>i,od:()=>s,qj:()=>a});var r=n(9476);function s(){let{customers:e}=r.N.getState();return e||[]}function a(e){if(!e)return"Interessent";switch(e){case 1:return"Kunde";case 2:return"Lieferant";case 3:return"Kunde & Lieferant";case 4:return"Management";case 5:return"Kunde & Management";case 6:return"Lieferant & Management";case 7:return"Kunde & Lieferant & Management";case 8:return"Partner";case 9:return"Kunde & Partner";case 10:return"Lieferant & Partner";case 11:return"Kunde & Lieferant & Partner";case 12:return"Management & Partner";case 13:return"Kunde & Management & Partner";case 14:return"Lieferant & Management & Partner";case 15:return"Kunde & Lieferant & Management & Partner";case 16:return"Interest"}}function i(e){if(!e)return"blue";switch(e){case 1:return"green";case 2:return"yellow";case 3:return"red";case 4:return"purple";case 5:return"pink";case 6:return"orange";case 7:return"teal";case 8:return"gray";case 9:return"indigo";case 10:return"lime";case 11:return"cyan";case 12:return"sky";case 13:return"grass";case 14:return"crimson";case 15:return"violet";case 16:return"blue"}}},9476:(e,t,n)=>{"use strict";n.d(t,{N:()=>r});let r=(0,n(9827).v)(e=>({customers:null,setCustomers:t=>e({customers:t})}))}},e=>{var t=t=>e(e.s=t);e.O(0,[105,209,963,944,441,587,358],()=>t(7446)),_N_E=e.O()}]);