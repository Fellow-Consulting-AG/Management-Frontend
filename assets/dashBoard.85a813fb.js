import{k as Y,aB as L,aC as E,c as n,h as i,ai as T,g as j,aM as H,aN as K,i as R,aO as W,_ as X,d as G,r as _,o as J,m as g,q as Z,s as c,p as a,z as h,f as r,v as B,n as f,t as x,F as ee,at as te,au as O,A as ae,B as se}from"./index.d19697de.js";import{Q as V}from"./QSelect.07937d19.js";import{b as $,Q as U}from"./QDialog.33d18147.js";import{u as oe,b as re}from"./focusout.fed31c9b.js";import{Q as ne}from"./QPage.8e1b4987.js";import{api as A}from"./axios.6b69d351.js";import"./QMenu.9bd878e0.js";import"./format.054b8074.js";import"./axios.ab682c6b.js";const ie={xs:2,sm:4,md:6,lg:10,xl:14};function P(e,o,l){return{transform:o===!0?`translateX(${l.lang.rtl===!0?"-":""}100%) scale3d(${-e},1,1)`:`scale3d(${e},1,1)`}}var le=Y({name:"QLinearProgress",props:{...oe,...L,value:{type:Number,default:0},buffer:Number,color:String,trackColor:String,reverse:Boolean,stripe:Boolean,indeterminate:Boolean,query:Boolean,rounded:Boolean,animationSpeed:{type:[String,Number],default:2100},instantFeedback:Boolean},setup(e,{slots:o}){const{proxy:l}=j(),y=re(e,l.$q),d=E(e,ie),v=n(()=>e.indeterminate===!0||e.query===!0),s=n(()=>e.reverse!==e.query),q=n(()=>({...d.value!==null?d.value:{},"--q-linear-progress-speed":`${e.animationSpeed}ms`})),C=n(()=>"q-linear-progress"+(e.color!==void 0?` text-${e.color}`:"")+(e.reverse===!0||e.query===!0?" q-linear-progress--reverse":"")+(e.rounded===!0?" rounded-borders":"")),k=n(()=>P(e.buffer!==void 0?e.buffer:1,s.value,l.$q)),b=n(()=>`with${e.instantFeedback===!0?"out":""}-transition`),w=n(()=>`q-linear-progress__track absolute-full q-linear-progress__track--${b.value} q-linear-progress__track--${y.value===!0?"dark":"light"}`+(e.trackColor!==void 0?` bg-${e.trackColor}`:"")),S=n(()=>P(v.value===!0?1:e.value,s.value,l.$q)),M=n(()=>`q-linear-progress__model absolute-full q-linear-progress__model--${b.value} q-linear-progress__model--${v.value===!0?"in":""}determinate`),N=n(()=>({width:`${e.value*100}%`})),D=n(()=>`q-linear-progress__stripe absolute-${e.reverse===!0?"right":"left"} q-linear-progress__stripe--${b.value}`);return()=>{const t=[i("div",{class:w.value,style:k.value}),i("div",{class:M.value,style:S.value})];return e.stripe===!0&&v.value===!1&&t.push(i("div",{class:D.value,style:N.value})),i("div",{class:C.value,style:q.value,role:"progressbar","aria-valuemin":0,"aria-valuemax":1,"aria-valuenow":e.indeterminate===!0?void 0:e.value},T(o.default,t))}}});const de=[i("circle",{cx:"15",cy:"15",r:"15"},[i("animate",{attributeName:"r",from:"15",to:"15",begin:"0s",dur:"0.8s",values:"15;9;15",calcMode:"linear",repeatCount:"indefinite"}),i("animate",{attributeName:"fill-opacity",from:"1",to:"1",begin:"0s",dur:"0.8s",values:"1;.5;1",calcMode:"linear",repeatCount:"indefinite"})]),i("circle",{cx:"60",cy:"15",r:"9","fill-opacity":".3"},[i("animate",{attributeName:"r",from:"9",to:"9",begin:"0s",dur:"0.8s",values:"9;15;9",calcMode:"linear",repeatCount:"indefinite"}),i("animate",{attributeName:"fill-opacity",from:".5",to:".5",begin:"0s",dur:"0.8s",values:".5;1;.5",calcMode:"linear",repeatCount:"indefinite"})]),i("circle",{cx:"105",cy:"15",r:"15"},[i("animate",{attributeName:"r",from:"15",to:"15",begin:"0s",dur:"0.8s",values:"15;9;15",calcMode:"linear",repeatCount:"indefinite"}),i("animate",{attributeName:"fill-opacity",from:"1",to:"1",begin:"0s",dur:"0.8s",values:"1;.5;1",calcMode:"linear",repeatCount:"indefinite"})])];var ce=Y({name:"QSpinnerDots",props:H,setup(e){const{cSize:o,classes:l}=K(e);return()=>i("svg",{class:l.value,fill:"currentColor",width:o.value,height:o.value,viewBox:"0 0 120 30",xmlns:"http://www.w3.org/2000/svg"},de)}});function ue(){return R(W)}const me=G({name:"AnalyticsDashboard",setup(){const e=ue(),o=_(null),l=_(new Date().getFullYear()),y=_([]),d=_([]),v=_(!1),s=new Date().getFullYear(),q=_(Array.from({length:5},(t,u)=>s-u)),C=n(()=>d.value.reduce((t,u)=>t+u.totalCredits,0)),k=n(()=>{const t=d.value.filter(u=>u.creditUsed>0).length;return t>0?C.value/t:0}),b=n(()=>d.value.reduce((t,u)=>u.creditUsed>t.creditUsed?u:t,d.value[0]||{monthName:"",creditUsed:0})),w=n(()=>Math.max(...d.value.map(t=>t.creditUsed),1)),S=async()=>{try{const t=await A.get("/v1/organisations");y.value=t.data.data||[]}catch(t){console.error("Error fetching organizations:",t),e.notify({type:"negative",message:"Failed to load organizations"})}},M=async()=>{if(!!o.value){v.value=!0;try{const t=await A.get("/v1/app_usage/get_usage_statistics",{params:{org_id:o.value,group_by:"month",start_date:`${l.value}-01-01`,end_date:`${l.value}-12-31`}});d.value=N(t.data.data||[])}catch(t){console.error("Error fetching usage data:",t),e.notify({type:"negative",message:"Failed to load usage statistics"})}finally{v.value=!1}}},N=t=>Array.from({length:12},(Ve,z)=>{const m=t.find(I=>I.month===z+1),F=(m==null?void 0:m.total_credit_used)||0,Q=(m==null?void 0:m.total_classification_credit_used)||0;return{month:z+1,monthName:new Date(2024,z).toLocaleString("default",{month:"long"}),creditUsed:F,classificationCreditUsed:Q,totalCredits:F+Q,transactionCount:(m==null?void 0:m.transaction_count)||0}}),D=t=>{if(t.creditUsed===0){e.notify({type:"info",message:`No usage data for ${t.monthName}`});return}e.dialog({title:`${t.monthName} ${l.value} Usage Details`,message:`
          <div class="q-pa-md">
            <div class="row q-gutter-md">
              <div class="col">
                <strong>Total Credits:</strong> ${t.totalCredits.toFixed(2)}
              </div>
              <div class="col">
                <strong>Document Processing:</strong> ${t.creditUsed.toFixed(2)}
              </div>
              <div class="col">
                <strong>Classification:</strong> ${t.classificationCreditUsed.toFixed(2)}
              </div>
              <div class="col">
                <strong>Transactions:</strong> ${t.transactionCount}
              </div>
            </div>
          </div>
        `,html:!0,ok:!0})};return J(()=>{S()}),{selectedOrg:o,selectedYear:l,organizations:y,yearOptions:q,monthlyData:d,loading:v,totalAnnualCredits:C,averageMonthlyUsage:k,highestMonth:b,maxMonthlyUsage:w,fetchUsageData:M,viewMonthDetails:D}}}),p=e=>(ae("data-v-993a1d76"),e=e(),se(),e),ve={class:"row q-mb-lg items-center q-gutter-md"},ge={class:"col-12 col-md-auto"},he={class:"q-my-none"},_e={class:"col-12 col-md-4"},fe={class:"col-12 col-md-2"},pe={key:0,class:"row q-gutter-md q-mb-lg"},ye={class:"col-12 col-md"},be=p(()=>a("div",{class:"text-h6"},"Total Annual Credits",-1)),qe={class:"text-h4 text-primary"},Ce={class:"col-12 col-md"},xe=p(()=>a("div",{class:"text-h6"},"Average Monthly Usage",-1)),$e={class:"text-h4 text-positive"},Ue={class:"col-12 col-md"},ke=p(()=>a("div",{class:"text-h6"},"Highest Month",-1)),we={class:"text-h4 text-warning"},Se={class:"text-caption"},Me={key:1,class:"row q-gutter-md"},Ne={class:"text-h6"},De=p(()=>a("div",{class:"text-caption"},"credits",-1)),ze={key:2,class:"text-center q-pa-xl"},Be=p(()=>a("div",{class:"text-h6 q-mt-md text-grey-7"}," Please select an organization to view usage analytics ",-1)),Fe={key:3,class:"text-center q-pa-xl"},Qe=p(()=>a("div",{class:"text-h6 q-mt-md"},"Loading usage data...",-1));function Oe(e,o,l,y,d,v){return g(),Z(ne,{class:"q-pa-md"},{default:c(()=>[a("div",ve,[a("div",ge,[a("h5",he,h(e.$t("header_names.analytics_dashboard")),1)]),a("div",_e,[r(V,{modelValue:e.selectedOrg,"onUpdate:modelValue":[o[0]||(o[0]=s=>e.selectedOrg=s),e.fetchUsageData],options:e.organizations,"option-label":"name","option-value":"org_id",label:"Organization",outlined:"",dense:"","emit-value":"","map-options":""},{prepend:c(()=>[r(B,{name:"business"})]),_:1},8,["modelValue","options","onUpdate:modelValue"])]),a("div",fe,[r(V,{modelValue:e.selectedYear,"onUpdate:modelValue":[o[1]||(o[1]=s=>e.selectedYear=s),e.fetchUsageData],options:e.yearOptions,label:"Year",outlined:"",dense:""},{prepend:c(()=>[r(B,{name:"calendar_today"})]),_:1},8,["modelValue","options","onUpdate:modelValue"])])]),e.selectedOrg&&e.monthlyData.length?(g(),f("div",pe,[a("div",ye,[r(U,{class:"text-center"},{default:c(()=>[r($,null,{default:c(()=>[be,a("div",qe,h(e.totalAnnualCredits.toFixed(2)),1)]),_:1})]),_:1})]),a("div",Ce,[r(U,{class:"text-center"},{default:c(()=>[r($,null,{default:c(()=>[xe,a("div",$e,h(e.averageMonthlyUsage.toFixed(2)),1)]),_:1})]),_:1})]),a("div",Ue,[r(U,{class:"text-center"},{default:c(()=>[r($,null,{default:c(()=>[ke,a("div",we,h(e.highestMonth.creditUsed.toFixed(2)),1),a("div",Se,h(e.highestMonth.monthName),1)]),_:1})]),_:1})])])):x("",!0),e.selectedOrg?(g(),f("div",Me,[(g(!0),f(ee,null,te(e.monthlyData,s=>(g(),f("div",{key:s.month,class:"col-12 col-sm-6 col-md-3"},[r(U,{class:O(["month-card cursor-pointer",{"bg-grey-2":s.creditUsed===0}]),onClick:q=>e.viewMonthDetails(s)},{default:c(()=>[r($,{class:"text-center"},{default:c(()=>[a("div",Ne,h(s.monthName),1),a("div",{class:O(["text-h4 q-my-sm",s.creditUsed>0?"text-primary":"text-grey"])},h(s.creditUsed.toFixed(2)),3),De,r(le,{value:s.creditUsed/e.maxMonthlyUsage,class:"q-mt-md",color:s.creditUsed>0?"primary":"grey-4","track-color":"grey-3",style:{height:"8px"}},null,8,["value","color"])]),_:2},1024)]),_:2},1032,["class","onClick"])]))),128))])):x("",!0),e.selectedOrg?x("",!0):(g(),f("div",ze,[r(B,{name:"analytics",size:"64px",color:"grey-5"}),Be])),e.loading?(g(),f("div",Fe,[r(ce,{size:"50px",color:"primary"}),Qe])):x("",!0)]),_:1})}var Ke=X(me,[["render",Oe],["__scopeId","data-v-993a1d76"]]);export{Ke as default};
